FUNCTION ZFM_ZYSGSF4.
*"----------------------------------------------------------------------
*"*"本地接口：
*"  IMPORTING
*"     REFERENCE(FIELD) TYPE  FIELDNAME OPTIONAL
*"     REFERENCE(SCRFIELD) TYPE  HELP_INFO-DYNPROFLD OPTIONAL
*"     REFERENCE(DBPT) TYPE  FUNCNAME OPTIONAL
*"----------------------------------------------------------------------
  DATA:ZFORM TYPE SY-XFORM." 调拨平台找车用  05.12.2022 19:43:47 by kkw
  IF DBPT IS INITIAL.
    ZFORM = 'CB_FORM1'.
  ELSE.
    ZFORM = 'CB_FORM2'.
  ENDIF.

  CASE FIELD.
    WHEN 'ZWLY' OR 'ZZDR' OR 'ZBG' OR 'ZYSR' OR 'ZSHR'.
      SELECT PARTNER AS LIFNR,
            NAME_ORG1 AS NAME1,
            BU_SORT1,
            BU_SORT2 AS BNAME
  INTO TABLE @DATA(IT_LIFNRF4)
  FROM BUT000
  WHERE BU_SORT2 NE ''
  AND   BU_GROUP = 'Z800'.
      PERFORM F4HELPN(ZPUBFORM) TABLES IT_LIFNRF4 USING 'LIFNR' SCRFIELD.
    WHEN 'ZYSGS' OR 'LIFNR'." 调拨平台添加lifnr  05.12.2022 19:51:29 by kkw
      SELECT LIFNR AS ZYSGS,
             NAME1
        INTO TABLE @DATA(IT_ZYSGS)
        FROM LFA1.
      PERFORM F4HELPN(ZPUBFORM) TABLES IT_ZYSGS USING FIELD SCRFIELD.
    WHEN 'ZYSZRR' OR 'ZYSFZR'.
      SELECT *
        INTO TABLE @DATA(IT_ZTMM212)
        FROM ZTMM212.
      CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST' "调用函数
        EXPORTING
          RETFIELD         = FIELD  "搜索帮助内表要输出的的帮助字段名，注：要大写
          DYNPPROG         = SY-REPID
          DYNPNR           = SY-DYNNR
          DYNPROFIELD      = SCRFIELD "屏幕字段
          VALUE_ORG        = 'S'
          CALLBACK_PROGRAM = SY-REPID
          CALLBACK_FORM    = ZFORM "'CB_FORM1'
        TABLES
          VALUE_TAB        = IT_ZTMM212 "存储搜索帮助内容的内表
        EXCEPTIONS
          PARAMETER_ERROR  = 1
          NO_VALUES_FOUND  = 2
          OTHERS           = 3.
      IF SY-SUBRC <> 0.
        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
        WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.
  ENDCASE.
ENDFUNCTION.
FORM CB_FORM1 TABLES RECORD_TAB STRUCTURE SEAHLPRES
           CHANGING SHLP TYPE SHLP_DESCR_T
                    CALLCONTROL LIKE DDSHF4CTRL.
  DATA: INTERFACE LIKE LINE OF SHLP-INTERFACE.
  CLEAR:INTERFACE.
  READ TABLE SHLP-INTERFACE INTO INTERFACE INDEX 1.
*选中后自动带出(SHLPFIELD字段结构F0001)
*  INTERFACE-SHLPFIELD+4(1) = '3'."F0001
*  INTERFACE-VALFIELD = 'ITAB-ZJUANH'.
*  APPEND INTERFACE TO SHLP-INTERFACE.
  INTERFACE-SHLPFIELD+4(1) = '2'.
  INTERFACE-VALFIELD = 'WA_HEAD-ZYSGS'.
  APPEND INTERFACE TO SHLP-INTERFACE.
ENDFORM.

FORM CB_FORM2 TABLES RECORD_TAB STRUCTURE SEAHLPRES " 调拨平台用  05.12.2022 19:49:23 by kkw
           CHANGING SHLP TYPE SHLP_DESCR_T
                    CALLCONTROL LIKE DDSHF4CTRL.
  DATA: INTERFACE LIKE LINE OF SHLP-INTERFACE.
  CLEAR:INTERFACE.
  READ TABLE SHLP-INTERFACE INTO INTERFACE INDEX 1.
*选中后自动带出(SHLPFIELD字段结构F0001)
*  INTERFACE-SHLPFIELD+4(1) = '3'."F0001
*  INTERFACE-VALFIELD = 'ITAB-ZJUANH'.
*  APPEND INTERFACE TO SHLP-INTERFACE.
  INTERFACE-SHLPFIELD+4(1) = '2'.
  INTERFACE-VALFIELD = 'WA_CH-LIFNR'.
  APPEND INTERFACE TO SHLP-INTERFACE.
ENDFORM.
