FUNCTION ZFM_GP_OA_PP_PCDSP.
*"----------------------------------------------------------------------
*"*"本地接口：
*"  EXPORTING
*"     VALUE(RTYPE) TYPE  BAPI_MTYPE
*"     VALUE(RTMSG) TYPE  BAPI_MSG
*"  TABLES
*"      INTAB STRUCTURE  ZSPP_218
*"      TRESULT STRUCTURE  ZSMM_017 OPTIONAL
*"----------------------------------------------------------------------
*20211117添加发货合同同步ecp by kkw。
*"----------------------------------------------------------------------
  ZFMDATASAVE1 'ZFM_GP_OA_PP_PCDSP'.
  ZFMDATASAVE2 'B'.
  COMMIT WORK.
  DATA:WA_205  TYPE ZTPP_205,
       IT_205A TYPE TABLE OF ZTPP_205A WITH HEADER LINE,
       IT_205B TYPE TABLE OF ZTPP_205B WITH HEADER LINE.

  DATA:ID TYPE I.
  CLEAR:ID.
  REFRESH:TRESULT,IT_205A,IT_205B.

  CHECK INTAB[] IS NOT INITIAL.
  LOOP AT INTAB.
    AT NEW ZPCDH.
      ID = ID + 1.
    ENDAT.
  ENDLOOP.
  IF ID NE 1.
    CLEAR:TRESULT.
    TRESULT-FLAG = 'E'.
    TRESULT-MESSAGE = '排产单号不唯一'.
    APPEND TRESULT.
    EXIT.
  ENDIF.

  READ TABLE INTAB INDEX 1.
*审核状态
  CLEAR:WA_205.
*取出原本的
  SELECT SINGLE *
    INTO WA_205
    FROM ZTPP_205
    WHERE ZPCDH = INTAB-ZPCDH.
  IF SY-SUBRC NE 0.
    CLEAR:TRESULT.
    TRESULT-FLAG = 'E'.
    TRESULT-MESSAGE = '未找到排产单号'.
    APPEND TRESULT.
    EXIT.
  ENDIF.
  WA_205-ZADUIT = INTAB-ZADUIT.
  UPDATE ZTPP_205 SET ZADUIT = INTAB-ZADUIT.
  UPDATE ZTPP_205B SET
  ZYF        = INTAB-ZYF
  ZCDTX      = INTAB-ZCDTX
  ZBZFS      = INTAB-ZBZFS
  ZDBFS      = INTAB-ZDBFS
  ZZYYQ      = INTAB-ZZYYQ
  BANFN      = INTAB-BANFN
  ZQGXX      = INTAB-ZQGXX
  ZGJSYYQ    = INTAB-ZGJSYYQ
  ZFLYQ      = INTAB-ZFLYQ
  ZWBFMYQ    = INTAB-ZWBFMYQ
  ZNBFMYQ    = INTAB-ZNBFMYQ
  ZLCFBYQ    = INTAB-ZLCFBYQ
  ZSCLX      = INTAB-ZSCLX
  ZSCDW      = INTAB-ZSCDW
  ZDDLX      = INTAB-ZDDLX
  ZSFWBZJ    = INTAB-ZSFWBZJ
  ZSFWCJG    = INTAB-ZSFWCJG
  ZBZYQ      = INTAB-ZBZYQ
  ZXCYQ      = INTAB-ZXCYQ
  ZXCRZ      = INTAB-ZXCRZ
  ZYMPP      = INTAB-ZYMPP
  ZZJBJGF    = INTAB-ZZJBJGF
  ZBHHSF     = INTAB-ZBHHSF
  ZLZJBDJ    = INTAB-ZLZJBDJ
  ZUZJBDJ    = INTAB-ZUZJBDJ
  ZSFNBZJ    = INTAB-ZSFNBZJ
  ZSFGD      = INTAB-ZSSGD
  ZGDPCDH    = INTAB-ZGDPCDH
  ZBC        = INTAB-ZBC
  ZSFECJG    = INTAB-ZSFECJG
  ZCKYQ      = INTAB-ZCKYQ
  ZZWJJGQGFY = INTAB-ZZWJJGQGFY
  ZFBCK      = INTAB-ZFBCK
  ZDBKS      = INTAB-ZDBKS
  ZFJMS      = INTAB-ZFJMS
  ZDKSL1     = INTAB-ZDKSL1
  ZZMS       = INTAB-ZZMS
  ZBCCD      = INTAB-ZBCCD
  ZDPGG      = INTAB-ZDPGG
  ZCKSL      = INTAB-ZCKSL
  WHERE ZPCDH = INTAB-ZPCDH.

  LOOP AT INTAB.
    UPDATE ZTPP_205A SET
    ZGKCB     = INTAB-ZGKCB
    ZKHML     = INTAB-ZKHML
    ZJCML     = INTAB-ZJCML
    ZMLDCL    = INTAB-ZMLDCL
    ZWBDJ     = INTAB-ZWBDJ
    ZNBDJ     = INTAB-ZNBDJ
    ZZZFY     = INTAB-ZZZFY
    ZFCFY     = INTAB-ZFCFY
    ZXCJG     = INTAB-ZXCJG
    ZBZJJ     = INTAB-ZBZJJ
    ZZHANKUAN      = INTAB-ZZK
    ZCD     = INTAB-ZZWCD
    ZXISHU       = INTAB-ZXS
    ZJJYQ     = INTAB-ZJJYQ
    ZFILE       = INTAB-ZTX
    ZZWHD     = INTAB-ZZWHD
    ZZS       = INTAB-ZZS
    ZDKSL       = INTAB-ZDK
    ZMB       = INTAB-ZMB
    ZBCKD     = INTAB-ZBCKD
  ZKHDJ      = INTAB-ZKHDJ
    WHERE ZPCDH = INTAB-ZPCDH AND ZPCDHH = INTAB-ZPCDHH.
  ENDLOOP.

  CLEAR:TRESULT.
  TRESULT-FLAG = 'S'.
  TRESULT-MESSAGE = '更新成功'.
  APPEND TRESULT.
  COMMIT WORK.

  ZFMDATASAVE2 'R'.
ENDFUNCTION.
