*&---------------------------------------------------------------------*
*& Include ZRMM207_TOP
*&---------------------------------------------------------------------*
TYPE-POOLS:SLIS,ICON.
DATA:FIELDCAT  TYPE SLIS_T_FIELDCAT_ALV,
     FIELDCAT1 TYPE SLIS_T_FIELDCAT_ALV,
     WA_FIELD  TYPE SLIS_FIELDCAT_ALV.
TYPES:BEGIN OF TY_OUT1,
        SEL,
        TOPPAGE,
        ICON    TYPE ICON-ID,
        MSG     TYPE BAPI_MSG,
        CHBOX1  TYPE CHAR1,
      END OF TY_OUT1,
      BEGIN OF TY_OUT2,
        ZWWLXT TYPE DDTEXT,
        ZZTT   TYPE DDTEXT,
        ZZZCT  TYPE DDTEXT,
        ZJSFST TYPE DDTEXT,
      END OF TY_OUT2,
      BEGIN OF TY_OUT3,
        MAKTX  TYPE MAKT-MAKTX,
        MAKTX1 TYPE MAKT-MAKTX,
        NAMEL  TYPE LFA1-NAME1,
        NAMEW  TYPE T001W-NAME1,
        LGOBE  TYPE T001L-LGOBE,
        T024   TYPE T024-EKNAM,
        BUTXT  TYPE T001-BUTXT,
        T023T  TYPE T023T-WGBEZ,
        PSPNR  TYPE PRPS-PSPNR,
        POST1  TYPE PRPS-POST1,
      END OF TY_OUT3,
      BEGIN OF TY_LIST,
        ID    TYPE CHAR10,
        VALUE TYPE CHAR50,
      END OF TY_LIST.
DATA BEGIN OF ITAB1 OCCURS 0.
INCLUDE STRUCTURE ZVMMPO.
INCLUDE TYPE TY_OUT3.
DATA:CGWQ  TYPE EKPO-MENGE,
     SHMNG TYPE EKPO-MENGE,
     AFNAM TYPE EBAN-AFNAM.
     INCLUDE TYPE TY_OUT2.
     INCLUDE TYPE TY_OUT1.
DATA: END OF ITAB1,
BEGIN OF IT_TEXT OCCURS 0,
  TDID TYPE STXL-TDID.
  INCLUDE STRUCTURE ZSMM202.
DATA:END OF IT_TEXT,
BEGIN OF ITAB2 OCCURS 0.
  INCLUDE STRUCTURE ZVMM208.
  INCLUDE TYPE TY_OUT3.
  INCLUDE TYPE TY_OUT2.
  INCLUDE TYPE TY_OUT1.
DATA: TDID  TYPE TDID,
  EKGRP TYPE EKKO-EKGRP,
  GZT   TYPE DDTEXT,
  ZZDRT TYPE NAME1,
  ZWLYT TYPE NAME1,
  ZCKBM TYPE ZVTMM215-ZCKBM,
END OF ITAB2,
BEGIN OF IT_ITEM OCCURS 0.
  INCLUDE STRUCTURE ZTMM209.
  INCLUDE TYPE TY_OUT3.
DATA:CHBOX,
     CELLSTYLE TYPE LVC_T_STYL,
END OF IT_ITEM,
WA_HEAD    LIKE LINE OF ITAB2,
  TEXTTABLE  TYPE TABLE OF ZSMM202 WITH HEADER LINE,
  ITAB2A     LIKE TABLE OF ITAB2 WITH HEADER LINE,
  WA_ITEM    LIKE LINE OF IT_ITEM,
  IT_ZWWFNO  TYPE TABLE OF ZSMM203 WITH HEADER LINE,
  ITAB1A     LIKE TABLE OF ITAB1 WITH HEADER LINE,
  ITAB1B     LIKE TABLE OF ITAB1 WITH HEADER LINE,
  ITAB1C     LIKE TABLE OF ITAB1 WITH HEADER LINE,
  IT_LIST1   TYPE TABLE OF TY_LIST WITH HEADER LINE,
  T_TEXT     TYPE TABLE OF ZSMM202 WITH HEADER LINE,
  IT_MATNR   TYPE TABLE OF CCVX_MATNR WITH HEADER LINE,
  IT_LIFNR   TYPE TABLE OF LFA1_KEY WITH HEADER LINE,
  IT_MAKT    TYPE TABLE OF MAKT WITH HEADER LINE,
  IT_LFA1    TYPE TABLE OF LFA1 WITH HEADER LINE,
  IT_BANFN   TYPE TABLE OF BANF_KEY WITH HEADER LINE,
  IT_EBAN    TYPE TABLE OF EBAN WITH HEADER LINE,
  IT_T001    TYPE TABLE OF T001 WITH HEADER LINE,
  IT_T001W   TYPE TABLE OF T001W WITH HEADER LINE,
  IT_T024    TYPE TABLE OF T024 WITH HEADER LINE,
  IT_T023T   TYPE TABLE OF T023T WITH HEADER LINE,
  IT_T001L   TYPE TABLE OF T001L WITH HEADER LINE,
  IT_RESB    TYPE TABLE OF RESB WITH HEADER LINE,
  IT_RSNUM   TYPE TABLE OF RSNR WITH HEADER LINE,
  IT_GZ      TYPE TABLE OF DD07V WITH HEADER LINE,
  IT_ZWWLX   TYPE TABLE OF DD07V WITH HEADER LINE,
  IT_ZZT     TYPE TABLE OF DD07V WITH HEADER LINE,
  IT_ZZZC    TYPE TABLE OF DD07V WITH HEADER LINE,
  IT_ZJSFS   TYPE TABLE OF DD07V WITH HEADER LINE,
  IT_EBELP   TYPE TABLE OF EKPO_KEY WITH HEADER LINE,
  IT_ZTMM212 TYPE TABLE OF ZTMM212 WITH HEADER LINE,
  IT_ZVTMM215 TYPE TABLE OF ZVTMM215 WITH HEADER LINE,
  IT_ZTMM208 TYPE TABLE OF ZTMM208 WITH HEADER LINE,
  IT_ZTMM209 TYPE TABLE OF ZTMM209 WITH HEADER LINE,
  IT_EBELN   TYPE TABLE OF ZSPUBS_FIELD WITH HEADER LINE,
  IT_EKKN    TYPE TABLE OF EKKN WITH HEADER LINE,
  IT_PSPNR   TYPE TABLE OF RCJ_PSPNR WITH HEADER LINE,
  IT_PRPS    TYPE TABLE OF PRPS WITH HEADER LINE,
  IT_KNUMV   TYPE TABLE OF ZSMMKNUMV WITH HEADER LINE,
  IT_PRCD    TYPE TABLE OF PRCD_ELEMENTS WITH HEADER LINE,
  IT_CGWQ    TYPE TABLE OF ZSFMS_GETCGWQ WITH HEADER LINE,
  IT_ZVMMPO  TYPE TABLE OF ZVMMPO WITH HEADER LINE,
  IT_ZVMM208 TYPE TABLE OF ZVMM208 WITH HEADER LINE,
  RETURN     TYPE TABLE OF BAPIRET2 WITH HEADER LINE.

DATA: FLAG1 TYPE CHAR1, "I-查看采购订单，U-到货单维度
      FLAG2 TYPE CHAR1,
      P1_X  TYPE CHAR1,
      P2_X  TYPE CHAR1,
      P3_X  TYPE CHAR1,
      P4_X  TYPE CHAR1,
      P5_X  TYPE CHAR1.

DATA:EXCLUDE      TYPE TABLE OF SY-UCOMM,
     TCODE        TYPE SY-TCODE,
     OK_CODE      TYPE SY-UCOMM,
     OK_CODE1     TYPE SY-UCOMM,
     TDID         TYPE TDID,
     NUM          TYPE I,
     ZWWFHH       TYPE ZTMM209-ZWWFHH,
     ANSWER       TYPE CHAR1,
     SELSTR       TYPE STRING,
     SELSTR1      TYPE STRING,
     MSG          TYPE BAPI_MSG,
     BUDAT TYPE BUDAT,
     RTYPE        TYPE BAPI_MTYPE,
     RTMSG        TYPE BAPI_MSG,
     L_MSG        TYPE BAPI_MSG,
     L_ZWWFNOLOCK TYPE ZTMM208-ZWWFNO.
FIELD-SYMBOLS:<FS>      TYPE ANY,
              <IT_MODI> TYPE LVC_T_MODI,
              <WA>      TYPE ANY,
              <FS1>     TYPE ANY,
              <ITAB>    TYPE STANDARD TABLE.

RANGES:S_KTOKK FOR LFA1-KTOKK,
       D_WERKS FOR EKPO-WERKS,
       S_BUDAT FOR SY-DATUM.
*OO-ALV
DATA:GO_EDITOR           TYPE REF TO CL_GUI_TEXTEDIT,
     GO_EDITOR_CONTAINER TYPE REF TO CL_GUI_CUSTOM_CONTAINER.
DATA:CONTAIN       TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
     ALVGRID       TYPE REF TO CL_GUI_ALV_GRID,
     IT_FIELDCAT   TYPE LVC_T_FCAT,
     WA_FIELDCAT   TYPE LVC_S_FCAT,
     IS_STABLE     TYPE LVC_S_STBL,
     WA_LAYOUT     TYPE LVC_S_LAYO,
     IT_EF1        TYPE UI_FUNCTIONS,
     VARIANT       TYPE DISVARIANT,
     CONTAIN1      TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
     ALVGRID1      TYPE REF TO CL_GUI_ALV_GRID,
     IT_FIELDCAT1  TYPE LVC_T_FCAT,
     IS_STABLE1    TYPE LVC_S_STBL,
     IT_F4         TYPE  LVC_T_F4,
     WA_F4         TYPE  LVC_S_F4,
     WA_MODI       TYPE LVC_S_MODI,
     IT_CELL       TYPE LVC_T_STYL,
     WA_CELL       TYPE LVC_S_STYL,
     RETURN_TAB    TYPE  TABLE OF DDSHRETVAL,
     WA_RETURN_TAB TYPE DDSHRETVAL,
     FIELD_TAB     TYPE TABLE OF DFIES WITH HEADER LINE.

CONSTANTS:TCODE1 TYPE SY-TCODE VALUE 'ZMM208A',
          TCODE2 TYPE SY-TCODE VALUE 'ZMM208B',
          TCODE3 TYPE SY-TCODE VALUE 'ZMM208C',
          TCODE4 TYPE SY-TCODE VALUE 'ZMM208D',
          TCODE5 TYPE SY-TCODE VALUE 'ZMM206',
          EXEC   TYPE CHAR4 VALUE 'ONLI',
          GREEN  TYPE ICON-ID VALUE '@08@',
          RED    TYPE ICON-ID VALUE '@0A@'.

DEFINE MSG.
  IF &1+0(1) = 'S'.
    MESSAGE &1 TYPE 'I'.
  ELSE.
    MESSAGE S000(OO) WITH &1 DISPLAY LIKE 'E'.
  ENDIF.
END-OF-DEFINITION.

DEFINE LOCK.
  CLEAR: L_ZWWFNOLOCK,L_MSG.
  L_ZWWFNOLOCK = &2.
IF &1 NE 'X'."加锁
CALL FUNCTION 'ENQUEUE_EZWWFNO'
 EXPORTING
   ZWWFNO                = L_ZWWFNOLOCK
   _SCOPE               = '1'
 EXCEPTIONS
   FOREIGN_LOCK         = 1
   SYSTEM_FAILURE       = 2
   OTHERS               = 3.
IF SY-SUBRC <> 0.
MESSAGE E012 WITH SY-MSGV1 SY-TCODE L_ZWWFNOLOCK.
ENDIF.
ELSE."解锁
CALL FUNCTION 'DEQUEUE_EZWWFNO'
 EXPORTING
*   MODE_ZSMM201       = 'E'
   ZWWFNO              = L_ZWWFNOLOCK
   _SCOPE             = '1'.

ENDIF.
END-OF-DEFINITION.
